{% extends "base.html" %}

{% block title %}{{ _('Edit Mirror') }} - {{ mirror.name }} - {{ _('Admin') }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-edit"></i> {{ _('Edit Mirror') }} - {{ mirror.name }}</h2>
    <a href="{{ url_for('admin.mirror_detail', mirror_id=mirror.id) }}" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> {{ _('Back to Mirror') }}
    </a>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-cog"></i> {{ _('Mirror Configuration') }}</h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="mb-3">
                        <label for="name" class="form-label">{{ _('Mirror Name') }}</label>
                        <input type="text" class="form-control" id="name" name="name" 
                               value="{{ mirror.name }}" required>
                        <div class="form-text">{{ _('Descriptive name for this mirror location') }}</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="direct_url" class="form-label">{{ _('Direct URL/IP') }}</label>
                        <input type="text" class="form-control" id="direct_url" name="direct_url" 
                               value="{{ mirror.direct_url }}" required>
                        <div class="form-text">
                            {{ _('Direct IP/domain and port for server-to-server communication') }}<br>
                            <small class="text-muted">{{ _('Examples: 123.123.123.123:5000, afharchive-mirror.duckdns.org:5000') }}</small>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="cloudflare_url" class="form-label">{{ _('Cloudflare Tunnel URL') }}</label>
                        <input type="url" class="form-control" id="cloudflare_url" name="cloudflare_url" 
                               value="{{ mirror.cloudflare_url or '' }}" placeholder="https://mirror.afharchive.xyz">
                        <div class="form-text">
                            {{ _('Public URL for serving files to users via Cloudflare Tunnel') }}<br>
                            <small class="text-muted">{{ _('Optional: Leave empty if not using Cloudflare Tunnel') }}</small>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="storage_path" class="form-label">{{ _('Storage Path') }}</label>
                        <input type="text" class="form-control" id="storage_path" name="storage_path" 
                               value="{{ mirror.storage_path or '' }}" placeholder="/mnt/mirror-storage">
                        <div class="form-text">
                            {{ _('Absolute path for file storage (useful for VM mirrors with block storage)') }}<br>
                            <small class="text-muted">{{ _('Optional: Leave empty to use default mirror_uploads directory') }}</small>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="max_files" class="form-label">{{ _('Maximum Files') }}</label>
                        <input type="number" class="form-control" id="max_files" name="max_files" 
                               value="{{ mirror.max_files }}" min="1" max="100000" required>
                        <div class="form-text">
                            {{ _('Maximum number of files this mirror should store') }}<br>
                            <small class="text-muted">{{ _('Files are prioritized by download count (most popular first)') }}</small>
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-start">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> {{ _('Save Changes') }}
                        </button>
                        <a href="{{ url_for('admin.mirror_detail', mirror_id=mirror.id) }}" class="btn btn-outline-secondary">
                            {{ _('Cancel') }}
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-info-circle"></i> {{ _('Configuration Help') }}</h5>
            </div>
            <div class="card-body">
                <h6>{{ _('Direct URL/IP') }}</h6>
                <p class="small text-muted mb-3">
                    {{ _('This is used for communication between the main server and mirror. Should include the port number.') }}
                </p>
                
                <h6>{{ _('Cloudflare URL') }}</h6>
                <p class="small text-muted mb-3">
                    {{ _('Public-facing URL for file downloads. Use this if you have a Cloudflare Tunnel set up for better performance and security.') }}
                </p>
                
                <h6>{{ _('Storage Path') }}</h6>
                <p class="small text-muted mb-3">
                    {{ _('Custom storage location. Useful for VMs with mounted block storage. Make sure the path exists and is writable.') }}
                </p>
                
                <h6>{{ _('Maximum Files') }}</h6>
                <p class="small text-muted">
                    {{ _('Controls how many files this mirror stores. The system automatically selects the most popular files to maximize cache hit rate.') }}
                </p>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h5><i class="fas fa-key"></i> {{ _('API Information') }}</h5>
            </div>
            <div class="card-body">
                <p class="small text-muted mb-2">{{ _('API Key') }}:</p>
                <p class="font-monospace text-break small bg-light p-2 rounded">{{ mirror.api_key }}</p>
                <small class="text-muted">{{ _('This key is used for mirror authentication. Keep it secure.') }}</small>
            </div>
        </div>
    </div>
</div>
{% endblock %}
